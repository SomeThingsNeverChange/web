---
- hosts: webservers
  become: yes
  tasks:
    - name: Apt update
      apt:
        upgrade: yes
        state: present
    - name: Install LAMP
      apt:
        name: mysql-server, php, libapache2-mod-php, php-mysql, apache2
        state: present
    - name: Allow Apache
      community.general.ufw:
        name: Apache
        rule: allow
        state: enabled
        port: 80
    - name: Create Virtual Host
      file:
        path: /var/www/domain
        owner: some
        state: directory
    - name: Set domain
          ansible.builtin.template:
        src: ~/ansible-practice/setdomain
        dest: /etc/apache2/sites-available/MyDomain.conf
        backup: yes
    - name: Enable site
      shell: /usr/sbin/a2ensite MyDomain
    - name: Sets up PHP info page
      ansible.builtin.template:
        src: ~/ansible-practice/phpinfo
        dest: /var/www/domain/info.php
        backup: yes
    - name: Reload apache2
      systemd:
        name: apache2
        state: reloaded
    - name: Restart apache2
      systemd:
        name: apache2
        state: restarted
